function _createForOfIteratorHelper(e,t){var n;if("undefined"==typeof Symbol||null==e[Symbol.iterator]){if(Array.isArray(e)||(n=_unsupportedIterableToArray(e))||t&&e&&"number"==typeof e.length){n&&(e=n);var r=0,a=function(){};return{s:a,n:function(){return r>=e.length?{done:!0}:{done:!1,value:e[r++]}},e:function(e){throw e},f:a}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var o,i=!0,s=!1;return{s:function(){n=e[Symbol.iterator]()},n:function(){var e=n.next();return i=e.done,e},e:function(e){s=!0,o=e},f:function(){try{i||null==n.return||n.return()}finally{if(s)throw o}}}}function _unsupportedIterableToArray(e,t){if(e){if("string"==typeof e)return _arrayLikeToArray(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?_arrayLikeToArray(e,t):void 0}}function _arrayLikeToArray(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function _defineProperties(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function _createClass(e,t,n){return t&&_defineProperties(e.prototype,t),n&&_defineProperties(e,n),e}(window.webpackJsonp=window.webpackJsonp||[]).push([[19],{Eco9:function(e,t,n){"use strict";n.r(t),n.d(t,"TournamentAdminPageModule",(function(){return O}));var r=n("ofXK"),a=n("3Pt+"),o=n("TEn/"),i=n("tyNb"),s=n("mrSG"),u=n("z6cu"),c=(n("t4lL"),n("AytR")),m=n("JIr8"),l=n("NEhk"),d=n("OYNw"),b=n("fXoL"),h=n("sYmb"),f=n("tk/3");function p(e,t){if(1&e){var n=b.Rb();b.Qb(0,"ion-item",8),b.Qb(1,"ion-label"),b.wc(2,"Team Tournament"),b.Pb(),b.Qb(3,"ion-checkbox",9),b.Yb("ngModelChange",(function(e){return b.pc(n),b.ac(2).administratedTournament.isTeamTournament=e})),b.Pb(),b.Pb()}if(2&e){var r=b.ac(2);b.Bb(3),b.gc("ngModel",r.administratedTournament.isTeamTournament)}}function v(e,t){if(1&e){var n=b.Rb();b.Qb(0,"ion-item",8),b.Qb(1,"ion-label"),b.wc(2,"Mode"),b.Pb(),b.Qb(3,"ion-select",10),b.Yb("ngModelChange",(function(e){return b.pc(n),b.ac(2).administratedTournament.type=e})),b.Qb(4,"ion-select-option",11),b.wc(5,"Swiss"),b.Pb(),b.Qb(6,"ion-select-option",12),b.wc(7,"Random"),b.Pb(),b.Pb(),b.Pb()}if(2&e){var r=b.ac(2);b.Bb(3),b.gc("ngModel",r.administratedTournament.type)}}function T(e,t){if(1&e){var n=b.Rb();b.Qb(0,"ion-item",8),b.Qb(1,"ion-label"),b.wc(2,"Tournament Name"),b.Pb(),b.Qb(3,"ion-input",13),b.Yb("ngModelChange",(function(e){return b.pc(n),b.ac(2).administratedTournament.name=e})),b.Pb(),b.Pb()}if(2&e){var r=b.ac(2);b.Bb(3),b.hc("placeholder",null==r.administratedTournament?null:r.administratedTournament.name),b.gc("ngModel",r.administratedTournament.name)}}function g(e,t){if(1&e){var n=b.Rb();b.Qb(0,"ion-item",8),b.Qb(1,"ion-label"),b.wc(2,"Minute Limit per round"),b.Pb(),b.Qb(3,"ion-input",14),b.Yb("ngModelChange",(function(e){return b.pc(n),b.ac(2).administratedTournament.timePerRound=e})),b.Pb(),b.Pb()}if(2&e){var r=b.ac(2);b.Bb(3),b.hc("placeholder",null==r.administratedTournament?null:r.administratedTournament.timePerRound),b.gc("ngModel",r.administratedTournament.timePerRound)}}function y(e,t){if(1&e){var n=b.Rb();b.Qb(0,"ion-item",15),b.Yb("click",(function(){return b.pc(n),b.ac(2).openPlayerSearchModal()})),b.wc(1," Add User "),b.Pb()}}function P(e,t){if(1&e){var n=b.Rb();b.Qb(0,"ion-item-sliding"),b.Qb(1,"ion-item",16),b.Qb(2,"ion-label"),b.wc(3),b.Pb(),b.Mb(4,"ion-reorder"),b.Pb(),b.Qb(5,"ion-item-options",17),b.Qb(6,"button",18),b.Yb("click",(function(){b.pc(n);var e=t.$implicit;return b.ac(2).removeUserFromTournament(e.id)})),b.Mb(7,"ion-icon",19),b.Pb(),b.Pb(),b.Pb()}if(2&e){var r=t.$implicit,a=t.index,o=b.ac(2);b.Bb(1),b.gc("ngClass",o.getClass(a)),b.Bb(2),b.yc(" ",r.name," ")}}function w(e,t){if(1&e){var n=b.Rb();b.Qb(0,"div"),b.Qb(1,"h1"),b.wc(2,"Tournament Settings"),b.Pb(),b.Qb(3,"ion-list"),b.uc(4,p,4,1,"ion-item",3),b.uc(5,v,8,1,"ion-item",3),b.uc(6,T,4,2,"ion-item",3),b.uc(7,g,4,2,"ion-item",3),b.uc(8,y,2,0,"ion-item",4),b.Pb(),b.Qb(9,"h1"),b.wc(10,"Players & Teams"),b.Pb(),b.Qb(11,"ion-list"),b.Qb(12,"ion-reorder-group",5),b.Yb("ionItemReorder",(function(e){return b.pc(n),b.ac().onRenderItems(e)})),b.uc(13,P,8,2,"ion-item-sliding",6),b.Pb(),b.Pb(),b.Qb(14,"ion-button",7),b.Yb("click",(function(){return b.pc(n),b.ac().saveLocalTournamentChanges()})),b.wc(15," Save changes "),b.Pb(),b.Qb(16,"ion-button",7),b.Yb("click",(function(){return b.pc(n),b.ac().startTournament()})),b.wc(17," Start Tournament "),b.Pb(),b.Pb()}if(2&e){var r=b.ac();b.Bb(4),b.gc("ngIf",r.administratedTournament),b.Bb(1),b.gc("ngIf",r.administratedTournament),b.Bb(1),b.gc("ngIf",r.administratedTournament),b.Bb(1),b.gc("ngIf",r.administratedTournament),b.Bb(1),b.gc("ngIf",r.administratedTournament),b.Bb(5),b.gc("ngForOf",r.localMembersList)}}function k(e,t){if(1&e){var n=b.Rb();b.Qb(0,"ion-item-sliding"),b.Qb(1,"ion-item",16),b.Qb(2,"ion-label"),b.wc(3),b.Pb(),b.Pb(),b.Qb(4,"ion-item-options",17),b.Qb(5,"button",18),b.Yb("click",(function(){b.pc(n);var e=t.$implicit;return b.ac(2).showAreYouSureYouWantToDelete(e.id)})),b.Mb(6,"ion-icon",19),b.Pb(),b.Pb(),b.Pb()}if(2&e){var r=t.$implicit,a=t.index,o=b.ac(2);b.Bb(1),b.gc("ngClass",o.getClass(a)),b.Bb(2),b.yc(" ",r.name," ")}}function C(e,t){if(1&e){var n=b.Rb();b.Qb(0,"div"),b.Qb(1,"h1"),b.wc(2),b.Pb(),b.Qb(3,"div"),b.Qb(4,"a",20),b.wc(5,"This is the tournament link"),b.Pb(),b.Pb(),b.Qb(6,"h1"),b.wc(7),b.Pb(),b.Qb(8,"ion-button",7),b.Yb("click",(function(){return b.pc(n),b.ac().startNextRound()})),b.wc(9," Start Next Round "),b.Pb(),b.Qb(10,"ion-button",7),b.Yb("click",(function(){return b.pc(n),b.ac().showAreYouSureYouWantToFinishTournament()})),b.wc(11," Finish Tournament "),b.Pb(),b.Qb(12,"h1"),b.wc(13,"Remove quitters"),b.Pb(),b.Qb(14,"ion-list"),b.uc(15,k,7,2,"ion-item-sliding",6),b.Pb(),b.Pb()}if(2&e){var r=b.ac();b.Bb(2),b.xc(r.administratedTournament.name),b.Bb(5),b.zc("Time till next round ",r.minutesTillNextRound,":",r.secondsTillNextRound,""),b.Bb(8),b.gc("ngForOf",r.administratedTournament.members)}}var I,Q,M,A=[{path:"",component:(I=function(){function e(t,n,r,a,o,i,s,u){_classCallCheck(this,e),this.router=t,this.translator=n,this.alertController=r,this.modalController=a,this.translateService=o,this.toastService=i,this.httpClient=s,this.toastController=u}return _createClass(e,[{key:"ngOnInit",value:function(){this.refreshTournament()}},{key:"startCountdown",value:function(){var e=this;this.roundStartDate=new Date,setInterval((function(){var t=(new Date).getTime(),n=e.roundStartDate.getTime()+6e4*e.administratedTournament.timePerRound-t;e.minutesTillNextRound=Math.floor(n%36e5/6e4),e.secondsTillNextRound=Math.floor(n%6e4/1e3)}),1e3)}},{key:"onRenderItems",value:function(e){console.log("Moving item from ".concat(e.detail.from," to ").concat(e.detail.to));var t=this.localMembersList.splice(e.detail.from,1)[0];this.localMembersList.splice(e.detail.to,0,t),e.detail.complete()}},{key:"removeUserFromTournament",value:function(e){var t=this;this.APIremoveUserFromTournament(this.administratedTournament._id,e).subscribe((function(e){t.administratedTournament=e,t.localMembersList=e.members}))}},{key:"showAreYouSureYouWantToDelete",value:function(e){return Object(s.a)(this,void 0,void 0,regeneratorRuntime.mark((function t(){var n,r=this;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,this.alertController.create({header:"Delete Player with Team",message:"The user and his whole team (if there are teams) will be deleted. This cannot be undone!",buttons:[{text:this.translator.instant("game.cancel"),role:"cancel",cssClass:"secondary",handler:function(e){}},{text:this.translator.instant("game.delete"),handler:function(){r.removeQuittersFromTournament(e)}}]});case 2:return n=t.sent,t.next=5,n.present();case 5:case"end":return t.stop()}}),t,this)})))}},{key:"showAreYouSureYouWantToFinishTournament",value:function(){return Object(s.a)(this,void 0,void 0,regeneratorRuntime.mark((function e(){var t,n=this;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.alertController.create({header:"Finish Tournament",message:"The tournament will be finished. Make sure everyone has finished their games as Games in progress will all be canceled and not counted. This cannot be undone! The admin section will be gone, you can check the winner etc on the website",buttons:[{text:this.translator.instant("game.cancel"),role:"cancel",cssClass:"secondary",handler:function(e){}},{text:"FINISH",handler:function(){n.APIfinishTournament(n.administratedTournament._id).subscribe((function(e){n.toastService.presentToast("Tournament finished")}))}}]});case 2:return t=e.sent,e.next=5,t.present();case 5:case"end":return e.stop()}}),e,this)})))}},{key:"removeQuittersFromTournament",value:function(e){var t,n=this,r=_createForOfIteratorHelper(this.administratedTournament.teams);try{var a=function(){var r=t.value;r.includes(e)&&n.APIremoveUserFromTournament(n.administratedTournament._id,r[0]).subscribe((function(e){n.APIremoveUserFromTournament(n.administratedTournament._id,r[1]).subscribe((function(e){n.APIupdateTeams(n.administratedTournament._id).subscribe((function(e){n.administratedTournament=e,n.localMembersList=e.members}))}))}))};for(r.s();!(t=r.n()).done;)a()}catch(o){r.e(o)}finally{r.f()}}},{key:"saveLocalTournamentChanges",value:function(){var e=this;this.administratedTournament.members=this.localMembersList,this.APIupdateTournament(this.administratedTournament).subscribe((function(t){e.administratedTournament=t,e.toastService.presentToast("Changes saved!")}))}},{key:"openPlayerSearchModal",value:function(){return Object(s.a)(this,void 0,void 0,regeneratorRuntime.mark((function e(){var t,n=this;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.modalController.create({component:d.a,cssClass:"auto-height bottom-sheet",showBackdrop:!0,mode:"ios"});case 2:return(t=e.sent).onDidDismiss().then((function(e){"guestAccount@test.com"===e.data.email?n.toastService.presentToast("Guest cannot be added to a tournament!"):e.data&&n.APIaddUserToTournament(n.administratedTournament._id,e.data.id,e.data.name).subscribe((function(e){n.administratedTournament=e,n.localMembersList=e.members,n.toastService.presentToast("User added!")}))})),e.next=6,t.present();case 6:return e.abrupt("return",e.sent);case 7:case"end":return e.stop()}}),e,this)})))}},{key:"startTournament",value:function(){var e=this;this.administratedTournament.isTeamTournament&&this.localMembersList.length%2!=0?this.toastService.presentToast("Uneven number of players are not allowed in a team tournament!"):(this.administratedTournament.members=this.localMembersList,this.APIupdateTournament(this.administratedTournament).subscribe((function(t){e.administratedTournament=t,e.startNextRound()})))}},{key:"refreshTournament",value:function(){var e=this;this.APIgetAdministratedTournament().subscribe((function(t){e.administratedTournament=t,e.localMembersList=t.members}))}},{key:"startNextRound",value:function(){var e=this;this.startCountdown(),this.APIstartNextRound(this.administratedTournament._id).subscribe((function(t){t.multipleGameActiveError?e.presentTooManyOpenGamesAlert(t.multipleGameActiveError):e.toastService.presentToast("New round started"),e.refreshTournament()}))}},{key:"presentTooManyOpenGamesAlert",value:function(e){return Object(s.a)(this,void 0,void 0,regeneratorRuntime.mark((function t(){var n;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,this.alertController.create({header:"Can't start new round",message:e+" have too many open games which need to be finished before you can start the new round",buttons:["OK"]});case 2:return n=t.sent,t.next=5,n.present();case 5:case"end":return t.stop()}}),t,this)})))}},{key:"getColor",value:function(e){switch(e%2==1&&(e="even"),e){case e="even":return"blue"}}},{key:"getClass",value:function(e){if(!this.administratedTournament.isTeamTournament)return{even:!0};switch(e%2==1&&(e="even"),e){case e="even":return{odd:!0}}return{even:!0}}},{key:"APIgetAdministratedTournament",value:function(){var e=this;return this.httpClient.get(c.b+"/tournament/administrated").pipe(Object(m.a)((function(t){return e.toastService.presentToast(),Object(u.a)(t)})))}},{key:"APIstartNextRound",value:function(e){var t=this;return this.httpClient.get("".concat(c.b,"/tournament/startNextRound/").concat(e)).pipe(Object(m.a)((function(e){return t.toastService.presentToast(),Object(u.a)(e)})))}},{key:"APIupdateTeams",value:function(e){var t=this;return this.httpClient.get("".concat(c.b,"/tournament/updateTeams/").concat(e)).pipe(Object(m.a)((function(e){return t.toastService.presentToast(),Object(u.a)(e)})))}},{key:"APIfinishTournament",value:function(e){var t=this;return this.httpClient.get("".concat(c.b,"/tournament/finish/").concat(e)).pipe(Object(m.a)((function(e){return t.toastService.presentToast(),Object(u.a)(e)})))}},{key:"APIupdateTournament",value:function(e){var t=this;return this.httpClient.post(c.b+"/tournament/update",{updatedTournament:e}).pipe(Object(m.a)((function(e){return t.toastService.presentToast(),Object(u.a)(e)})))}},{key:"APIaddUserToTournament",value:function(e,t,n){var r=this;return this.httpClient.post(c.b+"/tournament/addUser",{tournamentId:e,userId:t,userName:n}).pipe(Object(m.a)((function(e){return r.toastService.presentToast(),Object(u.a)(e)})))}},{key:"APIremoveUserFromTournament",value:function(e,t){var n=this;return this.httpClient.post(c.b+"/tournament/removeUser",{tournamentId:e,userId:t}).pipe(Object(m.a)((function(e){return n.toastService.presentToast(),Object(u.a)(e)})))}}]),e}(),I.\u0275fac=function(e){return new(e||I)(b.Lb(i.h),b.Lb(h.d),b.Lb(o.a),b.Lb(o.S),b.Lb(h.d),b.Lb(l.a),b.Lb(f.b),b.Lb(o.Z))},I.\u0275cmp=b.Fb({type:I,selectors:[["app-tournament-admin"]],decls:5,vars:2,consts:[[1,"top-spacer"],[1,"horizontal-margin"],[4,"ngIf"],["lines","none",4,"ngIf"],["lines","none",3,"click",4,"ngIf"],["disabled","false",3,"ionItemReorder"],[4,"ngFor","ngForOf"],[3,"click"],["lines","none"],["slot","end",3,"ngModel","ngModelChange"],["value","swiss",3,"ngModel","ngModelChange"],["value","swiss"],["value","random"],["slot","end",3,"ngModel","placeholder","ngModelChange"],["type","number","slot","end",3,"ngModel","placeholder","ngModelChange"],["lines","none",3,"click"],[3,"ngClass"],["side","end",1,"trash-slider"],["ion-button","","color","danger",1,"slide-button",3,"click"],["name","trash"],["href","www.google.ch"]],template:function(e,t){1&e&&(b.Qb(0,"ion-content"),b.Mb(1,"div",0),b.Qb(2,"div",1),b.uc(3,w,18,6,"div",2),b.uc(4,C,16,4,"div",2),b.Pb(),b.Pb()),2&e&&(b.Bb(3),b.gc("ngIf",!(null!=t.administratedTournament&&t.administratedTournament.teams)||0===(null==t.administratedTournament?null:t.administratedTournament.teams.length)),b.Bb(1),b.gc("ngIf",(null==t.administratedTournament?null:t.administratedTournament.teams)&&(null==t.administratedTournament?null:t.administratedTournament.teams.length)>0))},directives:[o.p,r.j,o.y,o.C,r.i,o.f,o.u,o.x,o.m,o.b,a.e,a.f,o.G,o.X,o.H,o.t,o.Y,o.U,o.w,r.h,o.B,o.v,o.s],styles:["ion-content[_ngcontent-%COMP%]{--ion-background-color:var(--ion-color-background)}ion-reorder[_ngcontent-%COMP%]{color:var(--ion-color-primary)}.odd[_ngcontent-%COMP%]{--border-color:var(--ion-color-primary)}.even[_ngcontent-%COMP%]{--border-color:var(--ion-color-background)}"]}),I)}],R=((Q=function e(){_classCallCheck(this,e)}).\u0275mod=b.Jb({type:Q}),Q.\u0275inj=b.Ib({factory:function(e){return new(e||Q)},imports:[[i.j.forChild(A)],i.j]}),Q),S=n("t5+X"),O=((M=function e(){_classCallCheck(this,e)}).\u0275mod=b.Jb({type:M}),M.\u0275inj=b.Ib({factory:function(e){return new(e||M)},imports:[[r.b,a.a,o.Q,R,S.a]]}),M)}}]);